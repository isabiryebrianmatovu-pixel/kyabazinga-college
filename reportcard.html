<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Student Report</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
    body {
        margin: 0;
        padding: 0;
        font-family: "Times New Roman", serif;
        background: #f4f4f4;
    }

    /* Controls outside printable area */
    .controls {
        max-width: 900px;
        margin: 20px auto;
        text-align: center;
    }
    .controls .btn {
        background: #444;
        color: white;
        padding: 8px 14px;
        border: none;
        border-radius: 4px;
        font-size: 15px;
        cursor: pointer;
        margin: 5px;
    }
    .controls .btn:hover { background: #222; }
    select {
        padding: 6px 10px;
        font-size: 15px;
        border-radius: 4px;
        border: 1px solid #444;
        margin-left: 10px;
    }

    /* Printable Report */
    .report-container {
        max-width: 900px;
        margin: 20px auto;
        padding: 20px;
        background: white;
        border: 4px solid #2f4f4f;
        border-radius: 10px;
        box-shadow: 0 0 15px rgba(0,0,0,0.2);
    }

    header.report-header {
        display: flex;
        align-items: center;
        border-bottom: 3px solid #2f4f4f;
        padding-bottom: 10px;
        margin-bottom: 20px;
    }
    header.report-header .left-section {
        flex: 1;
        text-align: left;
    }
    header.report-header .left-section img {
        height: 100px;
    }
    header.report-header .center-section {
        flex: 2;
        text-align: center;
        line-height: 1.4;
        color: #2f4f4f;
    }
    header.report-header .center-section h1 {
        margin: 0;
        font-size: 24px;
    }
    header.report-header .center-section p {
        margin: 2px 0;
    }
    header.report-header .right-section {
        flex: 1;
        text-align: right;
    }

    h2 {
        text-align: center;
        margin-bottom: 15px;
        color: #2f4f4f;
        font-size: 20px;
        font-weight: bold;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 20px;
    }
    th, td {
        padding: 10px;
        border: 1px solid #2f4f4f;
        text-align: center;
    }
    th { background: #e6e6e6; }

    .activities-container {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 15px;
    }
    .activity-card {
        border: 2px solid #2f4f4f;
        border-radius: 6px;
        padding: 10px;
        background: #fafafa;
    }
    .activity-card img {
        width: 100%;
        height: 150px;
        object-fit: cover;
        border-radius: 4px;
        margin-bottom: 10px;
    }
    .no-data { text-align:center; padding:10px; color:#555; }

    footer {
        text-align: center;
        padding: 10px;
        font-size: 14px;
        color: #555;
    }

    /* Print Styles */
    @media print {
        body { background: white; }
        .controls { display: none; }
        .report-container { box-shadow: none; border-width: 3px; }
    }
</style>
</head>
<body>

<!-- Controls outside printable area -->
<div class="controls">
    <button class="btn" onclick="window.location.href='visitor.html'">‚Üê Back</button>
    <button class="btn" onclick="window.print()">üñ® Print</button>
    <label for="studentSelect">Select Student:</label>
    <select id="studentSelect" onchange="loadStudentReport()">
        <option value="">--Choose Student--</option>
    </select>
</div>

<!-- Printable Report Area -->
<div class="report-container" id="reportContainer">

    <!-- Header with school badge and info -->
    <header class="report-header">
        <div class="left-section">
            <img src="schoolbadge.png" alt="School Badge">
        </div>
        <div class="center-section">
            <h1>KYABAZINGA COLLEGE</h1>
            <p>P.O.BOX 256, KAMULI</p>
            <p>"Educated and Cultured"</p>
            <p>Tel: 0779560903 / 0701061902 / 0756678814</p>
            <p>Email: kyabazingacollegekml@gmail.com</p>
        </div>
        <div class="right-section">
            <!-- Optional: Date or term -->
        </div>
    </header>

    <h2>ORDINARY LEVEL REPORT CARD</h2>

    <h3>Market Contributions</h3>
    <table>
        <thead>
            <tr>
                <th>Item Name</th>
                <th>Quantity</th>
                <th>Category</th>
                <th>Remarks</th>
            </tr>
        </thead>
        <tbody id="marketTable"></tbody>
    </table>

    <h3>Co-Curricular Activities</h3>
    <div class="activities-container" id="activitiesContainer"></div>

</div>

<footer>
    Organized and structured records for clarity and professionalism
</footer>

<script>
document.addEventListener("DOMContentLoaded", populateStudents);

function populateStudents() {
    const studentSelect = document.getElementById("studentSelect");
    const students = JSON.parse(localStorage.getItem("students")) || [];
    studentSelect.innerHTML = '<option value="">--Choose Student--</option>';
    students.forEach(s=>{
        const option = document.createElement("option");
        option.value = s.id;
        option.textContent = s.name;
        studentSelect.appendChild(option);
    });
}

function loadStudentReport() {
    const studentId = document.getElementById("studentSelect").value;
    loadMarket(studentId);
    loadActivities(studentId);
}

function loadMarket(studentId) {
    const tbody = document.getElementById("marketTable");
    tbody.innerHTML = "";
    const marketList = JSON.parse(localStorage.getItem("marketList")) || [];
    const studentMarket = marketList.filter(item => item.studentId === studentId);
    if(studentMarket.length===0){
        tbody.innerHTML='<tr><td colspan="4" class="no-data">No market contributions.</td></tr>';
        return;
    }
    studentMarket.forEach(item=>{
        const row=document.createElement("tr");
        row.innerHTML=`<td>${item.name}</td><td>${item.quantity}</td><td>${item.category}</td><td>${item.remarks}</td>`;
        tbody.appendChild(row);
    });
}

function loadActivities(studentId) {
    const container = document.getElementById("activitiesContainer");
    container.innerHTML = "";
    const activities = JSON.parse(localStorage.getItem("coCurricular")) || [];
    const studentActivities = activities.filter(act => act.studentId === studentId);
    if(studentActivities.length===0){
        container.innerHTML='<p class="no-data">No activities recorded.</p>';
        return;
    }
    studentActivities.forEach(act=>{
        const card = document.createElement("div");
        card.className = "activity-card";
        card.innerHTML=`<img src="${act.photo}" alt="Activity"><p>${act.description}</p>`;
        container.appendChild(card);
    });
}
</script>

</body>
</html>